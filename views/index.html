<div
    class="container"
    style="
        display: flex;
        flex-direction: column;
        gap: 1rem;
        align-items: center;
        justify-content: center;
        margin: 2rem;
    "
    x-data="{
        resetForm: {{.ResetForm}},
        fileError: '',
        validateFile(event) {
            const file = event.target.files[0];
            if (file && file.size > 5 * 1024 * 1024) {
                this.fileError = 'File size exceeds 5MB limit';
            } else {
                this.fileError = '';
            }
        }
    }"
    x-init="$watch('resetForm', function(newValue) {
        if (newValue) {
            $refs.uploadForm.reset();
            resetForm = false;
        }
    })"
>
    <h1>{{.Title}}</h1>
    <p>{{.Greeting}}</p>

    {{if not .IsLoggedIn}}
    <div>
        <a
            href="/auth/google"
            style="
                display: inline-block;
                background-color: #4285f4;
                color: white;
                padding: 10px 20px;
                text-decoration: none;
                border-radius: 5px;
                font-family: Arial, sans-serif;
            "
        >
            Login with Google
        </a>
    </div>
    {{else}}
    <p>Welcome back, {{.UserEmail}}!</p>
    {{end}} {{if .Error}}
    <p style="color: red">{{.Error}}</p>
    {{end}} {{if .ProcessedImage}}
    <p style="color: green">{{.Success}}</p>
    <h3>Processed Image:</h3>
    <img
        src="data:image/jpeg;base64,{{.ProcessedImage}}"
        alt="Processed Image"
    />
    {{end}} {{if .IsLoggedIn}}
    <form
        x-ref="uploadForm"
        action="/upload"
        method="POST"
        enctype="multipart/form-data"
    >
        <input
            type="text"
            name="email"
            id="name"
            placeholder="example@example.com"
            value="{{if .UserEmail}}{{.UserEmail}}{{end}}"
        />

        <input
            type="file"
            name="file"
            accept="image/jpeg,image/png"
            @change="validateFile($event)"
        />
        <p x-show="fileError" x-text="fileError" style="color: red"></p>
        <div style="display: flex; justify-content: flex-end">
            <input
                type="submit"
                value="Submit"
                :disabled="fileError !== ''"
                style="width: 200px"
            />
        </div>
    </form>
    <div>
        {{if .FlashMessage}}
        <div class="flash-message">{{.FlashMessage}}</div>
        {{end}} {{if .UserImages}}
        <h3>Your Images:</h3>
        <div style="display: flex; flex-wrap: wrap; gap: 10px">
            {{range .UserImages}}
            <div class="profile-picture flip">
                <div class="flipper">
                    <div class="front">
                        <img
                            src="data:image/jpeg;base64,{{.Base64String}}"
                            alt="User Image"
                            width="250px"
                        />
                    </div>
                    <div class="back">
                        <form method="POST" action="/delete-dialog/{{.ID}}">
                            <button type="submit">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
            {{end}}
        </div>
        {{else}}
        <p>No images uploaded yet.</p>
        {{end}}
    </div>
    {{end}}
</div>
<style>
    .profile-picture.flip {
        width: 200px;
        height: 200px;
        perspective: 1000px;
    }

    .profile-picture.flip .flipper {
        width: 100%;
        height: 100%;
        position: relative;
        transition: transform 0.8s;
        transform-style: preserve-3d;
    }

    .profile-picture.flip:hover .flipper {
        transform: rotateY(180deg);
    }

    .profile-picture.flip .front,
    .profile-picture.flip .back {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        border-radius: 50%;
        overflow: hidden;
        border: 7px solid #fff; /* White border for a clean look */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Soft shadow for depth */
    }

    .profile-picture.flip .front img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .profile-picture.flip .back {
        background-color: #3498db;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        transform: rotateY(180deg);
    }
</style>
